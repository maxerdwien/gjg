//rendering map stuff
var TileManager = function()
{
	this.jstring = '{ "height":32, "layers":[        {         "data":[1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 7, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 7, 1, 1, 1, 6, 6, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 6, 7, 1, 1, 6, 6, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 8, 14, 11, 1, 1, 6, 7, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 8, 2, 16, 12, 1, 1, 6, 6, 1, 1, 1, 1, 8, 14, 11, 1, 1, 1, 1, 1, 7, 6, 1, 1, 1, 1, 8, 14, 11, 1, 1, 8, 2, 16, 16, 12, 1, 1, 7, 6, 1, 1, 1, 1, 9, 16, 12, 1, 1, 1, 1, 1, 1, 6, 7, 1, 1, 1, 9, 16, 12, 8, 14, 2, 16, 16, 4, 13, 1, 1, 7, 7, 1, 1, 1, 1, 9, 16, 3, 14, 14, 14, 11, 1, 1, 1, 6, 1, 1, 1, 9, 16, 3, 2, 16, 16, 16, 4, 13, 1, 1, 1, 7, 6, 1, 1, 1, 1, 9, 16, 16, 16, 16, 16, 3, 14, 11, 1, 6, 1, 1, 1, 9, 16, 16, 16, 16, 4, 15, 13, 1, 1, 1, 1, 6, 6, 1, 1, 1, 1, 10, 15, 15, 15, 5, 16, 16, 16, 12, 1, 6, 7, 1, 8, 2, 16, 16, 16, 4, 13, 1, 1, 6, 6, 6, 1, 7, 6, 1, 1, 1, 1, 1, 1, 1, 1, 10, 15, 15, 5, 3, 14, 14, 7, 14, 2, 16, 16, 16, 4, 13, 1, 1, 1, 6, 6, 6, 1, 7, 7, 1, 1, 1, 1, 1, 1, 1, 1, 1, 8, 14, 2, 16, 16, 16, 6, 16, 16, 16, 16, 16, 12, 1, 1, 1, 1, 6, 6, 1, 1, 6, 6, 1, 1, 1, 1, 1, 1, 8, 14, 14, 2, 16, 16, 16, 16, 4, 6, 7, 15, 5, 16, 16, 3, 14, 11, 1, 1, 1, 6, 6, 1, 7, 6, 1, 1, 1, 1, 1, 8, 2, 16, 16, 16, 4, 15, 15, 15, 6, 6, 6, 1, 10, 15, 5, 16, 16, 12, 1, 1, 1, 6, 6, 1, 6, 6, 1, 1, 1, 1, 8, 2, 16, 16, 4, 15, 13, 1, 1, 7, 7, 7, 7, 6, 1, 1, 10, 5, 16, 3, 11, 1, 1, 1, 1, 1, 6, 6, 1, 1, 1, 8, 2, 16, 16, 4, 13, 1, 1, 1, 1, 7, 6, 7, 6, 7, 7, 6, 7, 10, 5, 16, 12, 1, 1, 1, 1, 1, 6, 7, 1, 1, 1, 9, 16, 16, 4, 13, 1, 1, 1, 1, 6, 6, 7, 6, 6, 7, 6, 7, 6, 6, 9, 16, 12, 1, 1, 1, 1, 1, 6, 7, 1, 1, 1, 9, 16, 4, 13, 1, 1, 1, 1, 1, 7, 6, 7, 7, 7, 7, 7, 6, 6, 7, 7, 16, 12, 1, 1, 1, 1, 1, 6, 7, 1, 1, 1, 9, 16, 12, 1, 1, 1, 1, 1, 6, 6, 7, 7, 7, 1, 1, 1, 1, 6, 1, 7, 16, 3, 11, 1, 1, 1, 1, 7, 7, 1, 1, 1, 9, 16, 3, 11, 1, 1, 1, 1, 7, 6, 7, 6, 6, 1, 1, 1, 1, 6, 1, 9, 16, 16, 12, 1, 1, 1, 1, 7, 7, 1, 1, 1, 9, 16, 16, 12, 1, 1, 1, 6, 7, 7, 7, 7, 7, 1, 1, 1, 1, 7, 1, 9, 16, 16, 12, 1, 1, 1, 1, 7, 6, 1, 1, 1, 10, 5, 16, 3, 11, 1, 1, 6, 7, 7, 7, 6, 7, 1, 1, 1, 1, 6, 1, 9, 16, 4, 13, 1, 1, 1, 1, 6, 7, 1, 1, 1, 1, 10, 5, 16, 12, 1, 1, 7, 7, 7, 6, 6, 1, 1, 1, 1, 1, 8, 14, 2, 16, 12, 1, 7, 1, 1, 1, 6, 7, 1, 1, 1, 1, 1, 10, 15, 13, 1, 1, 7, 7, 1, 1, 1, 1, 1, 1, 1, 8, 2, 16, 16, 16, 12, 1, 1, 1, 1, 1, 6, 7, 1, 1, 1, 1, 1, 1, 1, 1, 1, 7, 7, 1, 1, 1, 1, 1, 1, 1, 1, 9, 16, 16, 4, 15, 13, 1, 1, 1, 1, 1, 6, 6, 1, 1, 1, 1, 1, 1, 1, 1, 7, 6, 1, 1, 1, 1, 1, 1, 1, 1, 1, 10, 15, 15, 13, 1, 1, 1, 1, 1, 1, 1, 6, 7, 1, 1, 1, 7, 6, 6, 6, 6, 7, 6, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 7, 7, 7, 7, 6, 7, 7, 7, 6, 6, 6, 6, 6, 6, 6, 7, 6, 7, 6, 7, 6, 6, 7, 6, 7, 7, 6, 6, 6, 7, 6, 7, 6, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],         "height":32,         "name":"ground",         "opacity":1,         "type":"tilelayer",         "visible":true,         "width":32,         "x":0,         "y":0        },         {         "data":[17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 0, 0, 0, 17, 17, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 17, 17, 0, 0, 17, 17, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 17, 17, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 17, 17, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 17, 17, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 17, 17, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 17, 17, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 17, 17, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 17, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 17, 17, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 17, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 17, 17, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 17, 17, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 17, 17, 17, 0, 17, 17, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 17, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 17, 17, 17, 0, 17, 17, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 17, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 17, 17, 0, 0, 17, 17, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 17, 17, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 17, 17, 0, 17, 17, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 17, 17, 17, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 17, 17, 0, 17, 17, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 17, 17, 17, 17, 17, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 17, 17, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 17, 17, 17, 17, 17, 17, 17, 17, 0, 0, 0, 0, 0, 0, 0, 0, 0, 17, 17, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 0, 0, 0, 0, 0, 0, 0, 0, 17, 17, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 0, 0, 0, 0, 0, 0, 0, 17, 17, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 17, 17, 17, 17, 17, 0, 0, 0, 0, 17, 0, 17, 0, 0, 0, 0, 0, 0, 0, 17, 17, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 17, 17, 17, 17, 17, 0, 0, 0, 0, 17, 0, 0, 0, 0, 0, 0, 0, 0, 0, 17, 17, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 17, 17, 17, 17, 17, 17, 0, 0, 0, 0, 17, 0, 0, 0, 0, 0, 0, 0, 0, 0, 17, 17, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 17, 17, 17, 17, 17, 17, 0, 0, 0, 0, 17, 0, 0, 0, 0, 0, 0, 0, 0, 0, 17, 17, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 17, 17, 17, 17, 17, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 17, 0, 0, 0, 17, 17, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 17, 17, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 17, 17, 0, 0, 0, 0, 0, 0, 0, 0, 0, 17, 17, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 17, 17, 0, 0, 0, 0, 0, 0, 0, 0, 17, 17, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 17, 17, 0, 0, 0, 17, 17, 17, 17, 17, 17, 17, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],         "height":32,         "name":"collision",         "opacity":1,         "type":"tilelayer",         "visible":true,         "width":32,         "x":0,         "y":0        },         {         "draworder":"topdown",         "height":0,         "name":"treasure",         "objects":[                {                 "gid":18,                 "height":32,                 "name":"",                 "properties":                    {                    },                 "rotation":0,                 "type":"",                 "visible":true,                 "width":32,                 "x":584,                 "y":617                }],         "opacity":1,         "type":"objectgroup",         "visible":true,         "width":0,         "x":0,         "y":0        }], "orientation":"orthogonal", "properties":    {    }, "renderorder":"right-down", "tileheight":32, "tilesets":[        {         "firstgid":1,         "image":"Images\/forestterrains.png",         "imageheight":32,         "imagewidth":512,         "margin":0,         "name":"forestterrains",         "properties":            {            },         "spacing":0,         "terrains":[                {                 "name":"dirt",                 "tile":-1                },                 {                 "name":"forest",                 "tile":-1                }],         "tileheight":32,         "tiles":            {             "1":                {                 "terrain":[-1, 0, 0, 0]                },             "10":                {                 "terrain":[-1, -1, 0, -1]                },             "11":                {                 "terrain":[0, -1, 0, -1]                },             "12":                {                 "terrain":[0, -1, -1, -1]                },             "13":                {                 "terrain":[-1, -1, 0, 0]                },             "14":                {                 "terrain":[0, 0, -1, -1]                },             "15":                {                 "terrain":[0, 0, 0, 0]                },             "2":                {                 "terrain":[0, -1, 0, 0]                },             "3":                {                 "terrain":[0, 0, 0, -1]                },             "4":                {                 "terrain":[0, 0, -1, 0]                },             "5":                {                 "terrain":[1, 1, 1, 1]                },             "6":                {                 "terrain":[1, 1, 1, 1]                },             "7":                {                 "terrain":[-1, -1, -1, 0]                },             "8":                {                 "terrain":[-1, 0, -1, 0]                },             "9":                {                 "terrain":[-1, 0, -1, -1]                }            },         "tilewidth":32        },         {         "firstgid":17,         "image":"Images\/collision.png",         "imageheight":32,         "imagewidth":32,         "margin":0,         "name":"collision",         "properties":            {            },         "spacing":0,         "tileheight":32,         "tilewidth":32        },         {         "firstgid":18,         "image":"Images\/cardoor.png",         "imageheight":32,         "imagewidth":32,         "margin":0,         "name":"cardoor",         "properties":            {            },         "spacing":0,         "tileheight":32,         "tilewidth":32        }], "tilewidth":32, "version":1, "width":32}';
	this.jblob = JSON.parse(this.jstring);
	
	//image data
	this.spritemap = this.jblob.layers[0].data;
	Resource.Image.mspritesheet.src = this.jblob.tilesets[0].image;
	
	this.spritesize = { height: this.jblob.tileheight,
						width: this.jblob.tilewidth,
	}
	this.mapsize = { 	height: this.jblob.height,
						width: this.jblob.width,
	}
	
	//collision data
	this.collisionnum = this.jblob.tilesets[1].firstgid;
	this.collisionmap = this.jblob.layers[1].data;
	
	//car stuff
	Resource.Image.cardoor.src = this.jblob.tilesets[2].image;
	this.cardoornum = this.jblob.tilesets[2].firstgid;
}

TileManager.prototype =
{
	render: function(ctx)
	{
		for(i = 0; i < this.mapsize.height; i++)
		{
			for(j = 0; j< this.mapsize.width; j++)
			{
				ctx.drawImage(Resource.Image.mspritesheet, this.spritesize.width * (this.spritemap[(this.mapsize.height * i + j)] - 1), 0, this.spritesize.width-1, this.spritesize.height-1, this.spritesize.width * j * 4 - gx, this.spritesize.height * i * 4 - gy, this.spritesize.width * 4, this.spritesize.height * 4);
			}
		}
	},
	
	initwalls: function(grid)
	{
		var walls = [];
		var count = 0;
		for(var i = 0; i < this.mapsize.height; i++)
		{
			for(var j = 0; j< this.mapsize.width; j++)
			{
				if(this.collisionmap[this.mapsize.height * i + j] == this.collisionnum)
				{
					walls.push(new Wall(this.spritesize.width * j * 4 - gx, this.spritesize.height * i * 4 - gy, grid));
					grid.add(walls[count]);
					count++;
				}
			}
		}
		return walls;
	},
}